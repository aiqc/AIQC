<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta property="og:title" content="Heterogeneous/ Multi-Modal" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://docs.aiqc.io/notebooks/gallery/tensorflow/heterogeneous.html" />
  <meta property="og:site_name" content="AIQC" />
  <meta property="og:description" content="Binary Classification of Galaxy Morphologies Using Images Paired with Tabular Metadata. c665a814c7fa404ca6dac04f3b873401 Mixed data analysis is one of the areas where deep learning really sets itse..." />
  <meta property="og:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/_static/images/web/meta_image_tall_rect.png" />
  <meta property="og:image:alt" content="Artificial Intelligence Quality Control" />
  <meta property="twitter:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/_static/images/web/meta_image_tall_rect.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heterogeneous/ Multi-Modal &mdash; AIQC</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/aiqc_logo_square_blues_transparent.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pages/gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#AIQC-Python-Package">AIQC Python Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#Environment-Setup">Environment Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Python-Version">Python Version</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../installation.html#Pickle-Disclaimer">Pickle Disclaimer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Operating-System">Operating System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Optional---JupyterLab-IDE">Optional - JupyterLab IDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Optional---Swap-Space-for-Failover-Memory">Optional - Swap Space for Failover Memory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#Location-of-AIQC-Files">Location of AIQC Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Location-Based-on-OS">Location Based on OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Database">Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Config">Config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#Optional---Deleting-the-Database">Optional - Deleting the Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#a)-One-Liner">a) One-Liner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#b)-Or-Line-by-Line">b) Or Line-by-Line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#Troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#Reloading-the-Package">Reloading the Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard.html">UI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dashboard.html#Experiment-Tracker">Experiment Tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dashboard.html#Compare-Models-Head-to-Head">Compare Models Head-to-Head</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dashboard.html#What-If-Analysis">What-If Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dashboard.html#Run-the-App">Run the App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dashboard.html#What-about-JupyterDash?">What about JupyterDash?</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_high_level.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_high_level.html#Declarative">Declarative</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_high_level.html#1.-Pipeline">1. <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_high_level.html#1a.-Input">1a. <code class="docutils literal notranslate"><span class="pre">Input</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_high_level.html#1ai.-Input.Interpolater">1ai. <code class="docutils literal notranslate"><span class="pre">Input.Interpolater</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_high_level.html#1aii.-Input.Window">1aii. <code class="docutils literal notranslate"><span class="pre">Input.Window</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_high_level.html#1aiii.-Input.Encoder">1aiii. <code class="docutils literal notranslate"><span class="pre">Input.Encoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_high_level.html#1b.-Target">1b. <code class="docutils literal notranslate"><span class="pre">Target</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_high_level.html#1bi.-Target.Interpolater">1bi. <code class="docutils literal notranslate"><span class="pre">Target.Interpolater</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_high_level.html#1bii.-Target.Encoder">1bii. <code class="docutils literal notranslate"><span class="pre">Target.Encoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_high_level.html#1c.-Stratifier">1c. <code class="docutils literal notranslate"><span class="pre">Stratifier</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_high_level.html#2.-Experiment">2. <code class="docutils literal notranslate"><span class="pre">Experiment</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_high_level.html#2a.-Architecture">2a. <code class="docutils literal notranslate"><span class="pre">Architecture</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_high_level.html#2b.-Trainer">2b. <code class="docutils literal notranslate"><span class="pre">Trainer</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_high_level.html#3.-Inference">3. <code class="docutils literal notranslate"><span class="pre">Inference</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_low_level.html">ORM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#Object-Relational-Model">Object-Relational Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#0.-BaseModel">0. BaseModel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#0a.-Methods">0a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#0b.-Attributes">0b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#1.-Dataset">1. Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#1a.-Methods">1a. Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#1ai.-Registration">1ai. Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#1aii.-Fetch">1aii. Fetch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#1b.-Attributes">1b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#2.-Feature">2. Feature</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#2a.-Methods">2a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#2b.-Attributes">2b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#3.-Label">3. Label</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#3a.-Methods">3a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#3b.-Attributes">3b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#4.-Interpolate">4. Interpolate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#4a.-LabelInterpolater">4a. <code class="docutils literal notranslate"><span class="pre">LabelInterpolater</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#4ai.-Methods">4ai. Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#4aii.-Attributes">4aii. Attributes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#4b.-FeatureInterpolater">4b. <code class="docutils literal notranslate"><span class="pre">FeatureInterpolater</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#4bi.-Methods">4bi. Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#4bii.-Attributes">4bii. Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#5.-Encode">5. Encode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#5a.-LabelCoder">5a. <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#5ai.-Methods">5ai. Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#5aii.-Attributes">5aii. Attributes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#5b.-FeatureCoder">5b. <code class="docutils literal notranslate"><span class="pre">FeatureCoder</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#5bi.-Methods">5bi. Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api_low_level.html#5bii.-Attributes">5bii. Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#6.-Shape">6. Shape</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#6a.-Methods">6a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#6b.-Attributes">6b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#7.-Window">7. Window</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#7a.-Methods">7a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#7b.-Attributes">7b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#8.-Splitset">8. Splitset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#8a.-Methods">8a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#8b.-Attributes">8b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#9.-Algorithm">9. Algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#9a.-Methods">9a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#9b.-Attributes">9b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#10.-Hyperparameters">10. Hyperparameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#10a.-Methods">10a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#10b.-Attributes">10b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#11.-Queue">11. Queue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#11a.-Methods">11a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#11b.-Attributes">11b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#12.-Job">12. Job</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#12a.-Methods">12a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#12b.-Attributes">12b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#13.-Predictor">13. Predictor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#13a.-Methods">13a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#13b.-Attributes">13b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#14.-Prediction">14. Prediction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#14a.-Methods">14a. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_low_level.html#14b.-Attributes">14b. Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_low_level.html#Evaluation">Evaluation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html">Datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../datasets.html#Overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets.html#Prepackaged-Local-Data">Prepackaged Local Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets.html#Remote-Data">Remote Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets.html#Alternative-Sources">Alternative Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../evaluation.html">Evaluation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../evaluation.html#Overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../evaluation.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../evaluation.html#Classification">Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Queue-Visualization">Queue Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Queue-Metrics">Queue Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Job-Visualization">Job Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Job-Metrics">Job Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Prediction-Visualization">Prediction Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#Prediction-Metrics">Prediction Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../evaluation.html#Regression">Regression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#id1">Queue Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#id2">Queue Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#id3">Job Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation.html#id4">Job Metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pages/explainer.html">Deep Learning 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pages/community.html">Open Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#how-can-i-get-involved">How can I get involved?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#how-can-i-contribute">How can I contribute?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#setting-up-dev-environment">Setting up dev environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#programming-style">Programming style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#code-of-conduct">Code of conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#guild-bylaws-aka-governance">Guild bylaws (aka governance)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#aiqc-inc-is-open-core">AIQC, Inc. is open core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/community.html#id1">Open source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../pages/community.html#choosing-a-license">Choosing a license</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../pages/compare.html">Competition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pages/mission.html">Mission</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/mission.html#why-does-aiqc-exist">Why Does AIQC Exist?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/mission.html#accelerate-science-by-making-deep-learning-accessible">1. Accelerate science by making deep learning accessible.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/mission.html#bring-the-scientific-method-to-data-science">2. Bring the scientific method to data science.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pages/mission.html#break-down-walled-gardens-to-keep-science-open">3. Break down walled gardens to keep science open.</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AIQC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Heterogeneous/ Multi-Modal</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/notebooks/gallery/tensorflow/heterogeneous.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Heterogeneous/-Multi-Modal">
<h1>Heterogeneous/ Multi-Modal<a class="headerlink" href="#Heterogeneous/-Multi-Modal" title="Permalink to this headline"></a></h1>
<p><em>Binary Classification of Galaxy Morphologies Using Images Paired with Tabular Metadata.</em></p>
<p><img alt="c665a814c7fa404ca6dac04f3b873401" class="banner-photo" src="../../../_images/spirals.png" /></p>
<p>Mixed data analysis is one of the areas where deep learning really sets itself apart from traditional forms of statistics and machine learning. Neural networks are an effective way to logically encode and combine any type of data (image, text, time series, audio, tabular spreadsheets, video, etc) within the same analysis while converging toward the minimization a single <em>loss</em> metric. This leads to rich experiments that resemble real-world scenarios that resemble man-machine symbiosis. For
example, consider combining a doctor’s annotations with electronic medical records and histology imagery.</p>
<blockquote>
<div><p><em>Due to the fact that these images were captured by different instruments that represent color differently, I removed the noisy 3-channel color information and proceeded with grayscale. Since the shapes of the features are dynamically passed into the model, the only difference between a single versus multi-channel workflow is changing the actual layers (e.g. ``Conv1D`` to ``Conv2D``).</em></p>
</div></blockquote>
<hr class="docutils" />
<section id="💾-Data">
<h2>💾 Data<a class="headerlink" href="#💾-Data" title="Permalink to this headline"></a></h2>
<p>Reference <a class="reference external" href="../../datasets.html">Example Datasets</a> for more information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiqc</span> <span class="kn">import</span> <span class="n">datum</span>
<span class="kn">from</span> <span class="nn">aiqc.orm</span> <span class="kn">import</span> <span class="n">Dataset</span>
</pre></div>
</div>
</div>
<section id="Tabular-Data">
<h3>Tabular Data<a class="headerlink" href="#Tabular-Data" title="Permalink to this headline"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="s1">&#39;galaxies.tsv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Using the built-in structured data about 40 galaxies, we’ll derive:</p>
<ul class="simple">
<li><p>A binary, categorical label: <code class="docutils literal notranslate"><span class="pre">morphology</span></code>.</p></li>
<li><p>Categorical and numeric metadata features: <code class="docutils literal notranslate"><span class="pre">clarity</span></code>, <code class="docutils literal notranslate"><span class="pre">angle</span></code>.</p></li>
<li><p>A manifest detailing where to find our image files: <code class="docutils literal notranslate"><span class="pre">url</span></code>.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>morphology</th>
      <th>clarity</th>
      <th>angle</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bar</td>
      <td>0</td>
      <td>face</td>
      <td>https://raw.githubusercontent.com/aiqc/aiqc/ma...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bar</td>
      <td>3</td>
      <td>angle</td>
      <td>https://raw.githubusercontent.com/aiqc/aiqc/ma...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bar</td>
      <td>3</td>
      <td>face</td>
      <td>https://raw.githubusercontent.com/aiqc/aiqc/ma...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>From a single <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> we’ll specify a <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">Feature</span></code> before encoding them.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Image-Data">
<h3>Image Data<a class="headerlink" href="#Image-Data" title="Permalink to this headline"></a></h3>
<p>Construct a <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code> from that manifest and use it as a 2nd <code class="docutils literal notranslate"><span class="pre">Feature</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urls</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_img</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_urls</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
🖼️ Ingesting Images 🖼️: 100%|████████████████████████| 40/40 [00:06&lt;00:00,  5.96it/s]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_images</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">to_pillow</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">dataset_img</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Bar galaxies</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_images</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_gallery_tensorflow_heterogeneous_21_0.png" src="../../../_images/notebooks_gallery_tensorflow_heterogeneous_21_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_gallery_tensorflow_heterogeneous_22_0.png" src="../../../_images/notebooks_gallery_tensorflow_heterogeneous_22_0.png" />
</div>
</div>
<p>Although it is easy enough to distinguish between the two types with the naked eye, you start to realize that a <em>bar</em> galaxy is almost like a degraded <em>spiral</em> galaxy. Like anything else, there is a gray area in whether or not the band of stars/ rectangle of light connecting the two main galactic arms is to be considered a “bar” or more of an oval.</p>
<p><strong>Spiral galaxies</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_images</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_gallery_tensorflow_heterogeneous_25_0.png" src="../../../_images/notebooks_gallery_tensorflow_heterogeneous_25_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_images</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_gallery_tensorflow_heterogeneous_26_0.png" src="../../../_images/notebooks_gallery_tensorflow_heterogeneous_26_0.png" />
</div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="🚰-Pipeline">
<h2>🚰 Pipeline<a class="headerlink" href="#🚰-Pipeline" title="Permalink to this headline"></a></h2>
<p>Reference <a class="reference internal" href="../../api_high_level.html"><span class="doc">High-Level API Docs</span></a> for more information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiqc.mlops</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Target</span><span class="p">,</span> <span class="n">Stratifier</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">aiqc.utils.encoding</span> <span class="kn">import</span> <span class="n">div255</span><span class="p">,</span> <span class="n">mult255</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Input</span><span class="p">(</span>
            <span class="n">dataset</span>         <span class="o">=</span> <span class="n">shared_dataset</span><span class="p">,</span>
            <span class="n">exclude_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span>
            <span class="n">encoders</span>        <span class="o">=</span> <span class="p">[</span>
                <span class="n">Input</span><span class="o">.</span><span class="n">Encoder</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;clarity&#39;</span><span class="p">]),</span>
                <span class="n">Input</span><span class="o">.</span><span class="n">Encoder</span><span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span>  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="p">),</span>

        <span class="n">Input</span><span class="p">(</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset_img</span><span class="p">,</span>
            <span class="n">encoders</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">Encoder</span><span class="p">(</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">div255</span><span class="p">,</span> <span class="n">inverse_func</span><span class="o">=</span><span class="n">mult255</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">],</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">shared_dataset</span><span class="p">,</span>
        <span class="n">column</span>  <span class="o">=</span> <span class="s1">&#39;morphology&#39;</span><span class="p">,</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">Target</span><span class="o">.</span><span class="n">Encoder</span><span class="p">(</span><span class="n">OrdinalEncoder</span><span class="p">())</span>
    <span class="p">),</span>

    <span class="n">stratifier</span> <span class="o">=</span> <span class="n">Stratifier</span><span class="p">(</span>
        <span class="n">size_test</span>       <span class="o">=</span> <span class="mf">0.125</span><span class="p">,</span>
        <span class="n">size_validation</span> <span class="o">=</span> <span class="mf">0.175</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

└── Info - System overriding user input to set `sklearn_preprocess.copy=False`.
        This saves memory when concatenating the output of many encoders.


└── Info - System overriding user input to set `sklearn_preprocess.sparse=False`.
        This would have generated &#39;scipy.sparse.csr.csr_matrix&#39;, causing Keras training to fail.

</pre></div></div>
</div>
<hr class="docutils" />
</section>
<section id="🧪-Experiment">
<h2>🧪 Experiment<a class="headerlink" href="#🧪-Experiment" title="Permalink to this headline"></a></h2>
<p>Reference <a class="reference internal" href="../../api_high_level.html"><span class="doc">High-Level API Docs</span></a> for more information.</p>
<p>Below we see two towers, feedforward for tabular data and convolutional for image data, that are eventually concatenated together.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiqc.mlops</span> <span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">Architecture</span><span class="p">,</span> <span class="n">Trainer</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">layers</span> <span class="k">as</span> <span class="n">l</span>
<span class="kn">from</span> <span class="nn">aiqc.utils.tensorflow</span> <span class="kn">import</span> <span class="n">TrainingCallback</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fn_build</span><span class="p">(</span><span class="n">feature_shapes</span><span class="p">,</span> <span class="n">label_shape</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>

    <span class="c1"># Feed forward tower using the first Feature.</span>
    <span class="n">ff_input</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">feature_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;ff_neurons&#39;</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">ff_input</span><span class="p">)</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">ff</span><span class="p">)</span>
    <span class="n">model_ff</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">ff_input</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>

    <span class="c1"># Convolutional tower using the second Feature.</span>
    <span class="n">cnn_input</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">feature_shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span>
        <span class="mi">16</span><span class="o">*</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;cnn_multiply&#39;</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])(</span><span class="n">cnn_input</span><span class="p">)</span>
    <span class="c1">#cnn = l.MaxPool1D(pool_size=2)(cnn)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;dropout&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>

    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span>
        <span class="mi">16</span><span class="o">*</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;cnn_multiply&#39;</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="c1">#cnn = l.MaxPool1D(pool_size=2)(cnn)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;dropout&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>

    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span>
        <span class="mi">32</span><span class="o">*</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;cnn_multiply&#39;</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="c1">#cnn = l.MaxPool1D(pool_size=2)(cnn)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;dropout&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;cnn_4th&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span>
            <span class="mi">32</span><span class="o">*</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;cnn_multiply&#39;</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
            <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>
        <span class="c1">#cnn = l.MaxPool1D(pool_size=2)(cnn)</span>
        <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
        <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;dropout&#39;</span><span class="p">])(</span><span class="n">cnn</span><span class="p">)</span>

    <span class="c1"># Perform one dense layer on CNN output, so that the tabular data</span>
    <span class="c1"># can talk directly to the</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">cnn</span><span class="p">)</span>
    <span class="n">model_cnn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">cnn_input</span><span class="p">,</span> <span class="n">cnn</span><span class="p">)</span>

    <span class="n">concat</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">model_ff</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">model_cnn</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
    <span class="n">join</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;concat_neurons&#39;</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">concat</span><span class="p">)</span>
    <span class="n">join</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">join</span><span class="p">)</span>
    <span class="n">join</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">join</span><span class="p">)</span>
    <span class="n">join</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">join</span><span class="p">)</span>

    <span class="n">join</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">label_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)(</span><span class="n">join</span><span class="p">)</span>


    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">model_ff</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">model_cnn</span><span class="o">.</span><span class="n">input</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">join</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fn_train</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">loser</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span>
    <span class="n">train_features</span><span class="p">,</span> <span class="n">train_label</span><span class="p">,</span>
    <span class="n">eval_features</span><span class="p">,</span> <span class="n">eval_label</span><span class="p">,</span>
    <span class="o">**</span><span class="n">hp</span>
<span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span>        <span class="o">=</span> <span class="n">loser</span>
        <span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="p">,</span> <span class="n">metrics</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Early stopper.</span>
    <span class="n">metrics_cutoffs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span>     <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">above_or_below</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">above_or_below</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">),</span>
        <span class="c1">#only 5 samples in validation set.</span>
    <span class="p">]</span>
    <span class="n">cutoffs</span>   <span class="o">=</span> <span class="n">TrainingCallback</span><span class="o">.</span><span class="n">MetricCutoff</span><span class="p">(</span><span class="n">metrics_cutoffs</span><span class="p">)</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">History</span><span class="p">(),</span> <span class="n">cutoffs</span><span class="p">]</span>


    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">x</span>                 <span class="o">=</span> <span class="n">train_features</span>
        <span class="p">,</span> <span class="n">y</span>               <span class="o">=</span> <span class="n">train_label</span>
        <span class="p">,</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">eval_features</span><span class="p">,</span> <span class="n">eval_label</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">verbose</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="n">batch_size</span>      <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">epochs</span>          <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;epoch_count&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">callbacks</span>       <span class="o">=</span> <span class="n">callbacks</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">epoch_count</span>      <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">learning_rate</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">batch_size</span>     <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">ff_neurons</span>     <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">cnn_multiply</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">dropout</span>        <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">init</span>           <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;he_normal&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">cnn_4th</span>        <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">concat_neurons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">repeat_count</span></code> runs the same model multiple times due to the fact that neural networks are non-deterministic.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">Architecture</span><span class="p">(</span>
        <span class="n">library</span>           <span class="o">=</span> <span class="s2">&quot;keras&quot;</span>
        <span class="p">,</span> <span class="n">analysis_type</span>   <span class="o">=</span> <span class="s2">&quot;classification_binary&quot;</span>
        <span class="p">,</span> <span class="n">fn_build</span>        <span class="o">=</span> <span class="n">fn_build</span>
        <span class="p">,</span> <span class="n">fn_train</span>        <span class="o">=</span> <span class="n">fn_train</span>
        <span class="p">,</span> <span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
    <span class="p">),</span>

    <span class="n">Trainer</span><span class="p">(</span>
        <span class="n">pipeline</span>     <span class="o">=</span> <span class="n">pipeline</span><span class="p">,</span>
        <span class="n">repeat_count</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">run_jobs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
📦 Caching Splits 📦: 100%|██████████████████████████████████████████| 3/3 [00:00&lt;00:00, 267.72it/s]
🔮 Training Models 🔮:  25%|██████████▌                               | 1/4 [00:25&lt;01:16, 25.54s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
:: Epoch #247 ::
Congratulations - satisfied early stopping thresholds defined in `MetricCutoff` callback:
[{&#39;above_or_below&#39;: &#39;above&#39;, &#39;cutoff&#39;: 0.9, &#39;metric&#39;: &#39;accuracy&#39;},
 {&#39;above_or_below&#39;: &#39;above&#39;, &#39;cutoff&#39;: 0.8, &#39;metric&#39;: &#39;val_accuracy&#39;}]

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
🔮 Training Models 🔮:  50%|█████████████████████                     | 2/4 [00:42&lt;00:40, 20.44s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
:: Epoch #227 ::
Congratulations - satisfied early stopping thresholds defined in `MetricCutoff` callback:
[{&#39;above_or_below&#39;: &#39;above&#39;, &#39;cutoff&#39;: 0.9, &#39;metric&#39;: &#39;accuracy&#39;},
 {&#39;above_or_below&#39;: &#39;above&#39;, &#39;cutoff&#39;: 0.8, &#39;metric&#39;: &#39;val_accuracy&#39;}]

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
🔮 Training Models 🔮: 100%|██████████████████████████████████████████| 4/4 [01:23&lt;00:00, 20.78s/it]
</pre></div></div>
</div>
<hr class="docutils" />
</section>
<section id="📊-Visualization-&amp;-Interpretation">
<h2>📊 Visualization &amp; Interpretation<a class="headerlink" href="#📊-Visualization-&-Interpretation" title="Permalink to this headline"></a></h2>
<p>For more information on visualization of performance metrics, reference the <a class="reference external" href="../../dashboard.html">Dashboard</a> documentation.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>