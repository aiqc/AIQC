

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta property="og:title" content="Low-Level API" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aiqc.readthedocs.io/notebooks/api_low_level.html" />
  <meta property="og:site_name" content="AIQC" />
  <meta property="og:description" content="Prerequisites: If you‚Äôve already completed the instructions on the Installation page, then let‚Äôs get started.[1]: import aiqc from aiqc import datum 1. Ingest a Dataset: Object Relational Model (OR..." />
  <meta property="og:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/images/aiqc_logo_banner_controlroom.png" />
  <meta property="og:image:alt" content="Artificial Intelligence Quality Control" />
  <meta property="twitter:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/images/aiqc_logo_banner_controlroom.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Low-Level API &mdash; AIQC</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization &amp; Metrics" href="visualization.html" />
    <link rel="prev" title="High-Level API" href="api_high_level.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/aiqc_logo_wide_white_docs.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission.html">Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">Links</a></li>
</ul>
<p class="caption"><span class="caption-text">Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_datasets.html">Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="keras_binary_classification.html">Keras: Classify Binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="keras_multi-label_classification.html">Keras: Classify Multi-Label</a></li>
<li class="toctree-l1"><a class="reference internal" href="keras_regression.html">Keras: Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch.html">PyTorch (coming soon)</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api_high_level.html">High-Level API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Low-Level API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Ingest-a-Dataset">1. Ingest a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Object-Relational-Model-(ORM)">Object Relational Model (ORM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Persisting-and-Compressing-Structured-Data">Persisting and Compressing Structured Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Data-Sources">Data Sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Dataset.Tabular.from_pandas()"><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_pandas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dataset.Tabular.from_numpy()"><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_numpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dataset.Tabular.from_path"><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Image-Datasets">Image Datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dataset.Image.from_urls()"><code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_urls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dataset.Image.from_folder()"><code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_folder()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-Datasets">Reading Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dataset.Tabular.to_pandas()"><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.to_pandas()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dataset.Tabular.to_numpy()"><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.to_numpy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dataset.Image.to_pillow()"><code class="docutils literal notranslate"><span class="pre">Dataset.Image.to_pillow()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dataset.Image.to_numpy()"><code class="docutils literal notranslate"><span class="pre">Dataset.Image.to_numpy()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Select-the-Label-column(s).">2. Select the <code class="docutils literal notranslate"><span class="pre">Label</span></code> column(s).</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ORM">ORM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Deriving-Labels">Deriving Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-Labels">Reading Labels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Select-the-Featureset-column(s).">3. Select the <code class="docutils literal notranslate"><span class="pre">Featureset</span></code> column(s).</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">ORM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Deriving Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-Featuresets">Reading Featuresets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Slice-samples-with-a-Splitset.">4. Slice samples with a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Split-Strategies">Split Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a)-Default-supervised-70-30-split.">a) Default supervised 70-30 split.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b)-Specifying-test-size.">b) Specifying test size.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c)-Specifying-validation-size.">c) Specifying validation size.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d)-Taking-the-whole-dataset-as-a-training-split.">d) Taking the whole dataset as a training split.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#e)-Stratification-of-continuous-labels.">e) Stratification of continuous labels.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-Splitsets">Reading Splitsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Splitset.to_numpy()"><code class="docutils literal notranslate"><span class="pre">Splitset.to_numpy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Splitset.to_pandas()"><code class="docutils literal notranslate"><span class="pre">Splitset.to_pandas()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Optionally,-create-a-Foldset-for-cross-validation.">5. Optionally, create a <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> for cross-validation.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">ORM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Fold-objects"><code class="docutils literal notranslate"><span class="pre">Fold</span></code> objects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Deriving-Foldsets">Deriving Foldsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-Foldsets">Reading Foldsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Foldset.to_numpy()"><code class="docutils literal notranslate"><span class="pre">Foldset.to_numpy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Foldset.to_pandas()"><code class="docutils literal notranslate"><span class="pre">Foldset.to_pandas()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#6.-Optionally,-stage-an-Encoderset-for-encoding.">6. Optionally, stage an <code class="docutils literal notranslate"><span class="pre">Encoderset</span></code> for encoding.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Background">Background</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#7.-Optionally,-set-a-single-Labelcoder.">7. Optionally, set a single <code class="docutils literal notranslate"><span class="pre">Labelcoder</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Background</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#8.-Optionally,-determine-a-sequence-of-Featurecoder(s).">8. Optionally, determine a sequence of <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>(s).</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Filtering-feature-columns">Filtering feature columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#9.-Create-an-Algorithm-aka-model.">9. Create an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> aka model.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">ORM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-Definition">Model Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Function-to-build-model">Function to build model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Optional,-function-to-optimize-model.">Optional, function to optimize model.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Function-to-train-model">Function to train model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Optional,-function-to-predict-samples">Optional, function to predict samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Optional,-function-to-calculate-loss">Optional, function to calculate loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Group-the-functions-together-in-an-Algorithm!">Group the functions together in an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#8.-Optional,-associate-a-Hyperparamset-with-your-model.">8. Optional, associate a <code class="docutils literal notranslate"><span class="pre">Hyperparamset</span></code> with your model.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#9.-Create-a-Batch-of-training-Jobs.">9. Create a <code class="docutils literal notranslate"><span class="pre">Batch</span></code> of training <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Job-objects."><code class="docutils literal notranslate"><span class="pre">Job</span></code> objects.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Execute-all-Jobs.">Execute all <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#1.-batch.run_jobs(in_background=False)">1. <code class="docutils literal notranslate"><span class="pre">batch.run_jobs(in_background=False)</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-batch.run_jobs(in_background=True);-experimental">2. <code class="docutils literal notranslate"><span class="pre">batch.run_jobs(in_background=True)</span></code>; experimental</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Future,-distributed-cloud-execution.">3. Future, distributed cloud execution.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#10.-Assess-the-Results.">10. Assess the <code class="docutils literal notranslate"><span class="pre">Results</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Fetching-the-trained-model.">Fetching the trained model.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fetching-metrics.">Fetching metrics.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#11.-Metrics-&amp;-Visualization">11. Metrics &amp; Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization &amp; Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">Compatibility</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AIQC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Low-Level API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/notebooks/api_low_level.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Low-Level-API">
<h1>Low-Level API<a class="headerlink" href="#Low-Level-API" title="Permalink to this headline">¬∂</a></h1>
<div class="section" id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this headline">¬∂</a></h2>
<p>If you‚Äôve already completed the instructions on the <strong>Installation</strong> page, then let‚Äôs get started.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">aiqc</span>
<span class="kn">from</span> <span class="nn">aiqc</span> <span class="kn">import</span> <span class="n">datum</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1.-Ingest-a-Dataset">
<h2>1. Ingest a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code><a class="headerlink" href="#1.-Ingest-a-Dataset" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="Object-Relational-Model-(ORM)">
<h3>Object Relational Model (ORM)<a class="headerlink" href="#Object-Relational-Model-(ORM)" title="Permalink to this headline">¬∂</a></h3>
<p>At the moment, AIQC supports the following types of Datasets:</p>
<ul class="simple">
<li><p>Single-file tabular/ flat/ delimited datasets.</p></li>
<li><p>Multi-file image datasets.</p></li>
</ul>
<p>End users only need to worry about passing the right inputs to the Dataset class, but there are a few objects doing the legwork beneath the hood:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset</span></code> ORM class with subclasses of either <code class="docutils literal notranslate"><span class="pre">Tabular</span></code> or <code class="docutils literal notranslate"><span class="pre">Image</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">File</span></code> ORM class one or more files with subclasses of either <code class="docutils literal notranslate"><span class="pre">Tabular</span></code> or <code class="docutils literal notranslate"><span class="pre">Image</span></code>.</p>
<ul>
<li><p>Dedicated <code class="docutils literal notranslate"><span class="pre">Tabular</span></code> and <code class="docutils literal notranslate"><span class="pre">Image</span></code> ORM classes for attributes specific to those data types (e.g.¬†dtype mappings for flat files and colorscale for images).</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><p>Considering these types in the future: Sequence/ time series: multi-file tabular (e.g.¬†3D numpy, HDF5). Graph: multi-file nodes and multi-file edges (e.g.¬†DGL).</p>
</div></blockquote>
</div>
<div class="section" id="Persisting-and-Compressing-Structured-Data">
<h3>Persisting and Compressing Structured Data<a class="headerlink" href="#Persisting-and-Compressing-Structured-Data" title="Permalink to this headline">¬∂</a></h3>
<p>By default the actual bytes of the file are persisted to the SQLite <code class="docutils literal notranslate"><span class="pre">BlobField</span></code>. It gets gzip compressed, reducing the size by up to 90%. Maximum BlobField size is 2.147 GB, but once you factor in compression, your bottleneck is more likely to be memory beyond that size. The bytes themselves are Parquet (single-partitioned) because, using the PyArrow engine, it preserves every dtype except certain datetimes (which are honestly better off parsed into floats/ ordinal ints). Parquet is also
integrated nicely into both Spark and Dask; frameworks for distributed, in-memory computation.</p>
<p>Persisting the file ensures reproducibility by: (a) keeping the data packaged alongside the experiment, and (b) helping entry-level users move away from relying on mutable dataframes they have had in-memory for extended periods of time or floating around on shared file systems.</p>
<blockquote>
<div><p><em>However, we realize that a different approach will be required at scale, so the ``source_path`` of the file is recorded whenever possible. In the future we could just read the data from that path (e.g.¬†NFS, RDBMS, HDFS, S3) if the BlobField is none. Or just switch our data fetching/ filtering to Dask because it uses the Pandas API and Parquet.</em></p>
</div></blockquote>
</div>
<div class="section" id="Data-Sources">
<h3>Data Sources<a class="headerlink" href="#Data-Sources" title="Permalink to this headline">¬∂</a></h3>
<p>You can make a dataset from either:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code></p>
<ul>
<li><p>In-memory data structures (pandas dataframe, numpy array).</p></li>
<li><p>Flat files (csv, tsv, parquet).</p>
<ul>
<li><p>Accepts urls.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code></p>
<ul>
<li><p>Any image file format that can be read by the Pillow library.</p>
<ul>
<li><p>Accepts urls.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="Dataset.Tabular.from_pandas()">
<h4><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_pandas()</span></code><a class="headerlink" href="#Dataset.Tabular.from_pandas()" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="s1">&#39;iris.tsv&#39;</span><span class="p">)</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">df</span>
    <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;tab separated plants&#39;</span>
    <span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#passed to pd.Dataframe(dtype)/ inferred</span>
    <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#passed to pd.Dataframe(columns)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>Optionally, <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, as seen in the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.astype(dtype)</span></code> <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html">docs</a>, can be specified as either a single type for all columns, or as a dictionary that maps a specific type to each column name. This encodes features for analysis. We read NumPy into Pandas before persisting it, so <code class="docutils literal notranslate"><span class="pre">columns</span></code> and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> are read directly by <code class="docutils literal notranslate"><span class="pre">pd.DataFrame()</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="Dataset.Tabular.from_numpy()">
<h4><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_numpy()</span></code><a class="headerlink" href="#Dataset.Tabular.from_numpy()" title="Permalink to this headline">¬∂</a></h4>
<p>Must be a 2D NumPy N-Dimensional Array.</p>
<blockquote>
<div><p><em>In the future, we may add support for ingesting 3D arrays as multi-file sequences.</em></p>
</div></blockquote>
<p>Regular <em>ndarrays</em> don‚Äôt have column names, and I didn‚Äôt like the API for <em>structured arrays</em> so you have to pass in columns names as a list. If you don‚Äôt then column names will be numerically assigned in ascending order (zero-based index), but I didn‚Äôt like the range object, so I stringified numerically assigned columns to string-based numbers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">other_dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
    <span class="n">ndarray</span> <span class="o">=</span> <span class="n">arr</span>
    <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#passed to pd.Dataframe(dtype)/ inferred</span>
    <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">cols</span> <span class="c1">#passed to pd.Dataframe(columns)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Dataset.Tabular.from_path">
<h4><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_path</span></code><a class="headerlink" href="#Dataset.Tabular.from_path" title="Permalink to this headline">¬∂</a></h4>
<p>Intended for flat files, delimited text, and structured tabular data. It‚Äôs read in via Pandas, so it supports URLs to raw data and bytes as well.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">file_path</span></code> itself can be either absolute or relative.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">file_path</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;iris_10x.tsv&#39;</span><span class="p">)</span>

<span class="c1"># We&#39;ll keep this larger dataset handy for `Foldset` creation later.</span>
<span class="n">big_dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="p">,</span> <span class="n">source_file_format</span> <span class="o">=</span> <span class="s1">&#39;tsv&#39;</span>
    <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">skip_header_rows</span> <span class="o">=</span> <span class="s1">&#39;infer&#39;</span> <span class="c1">#passed to `pd.read_csv(header)`. Incompatible w Parquet.</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>If you leave <code class="docutils literal notranslate"><span class="pre">name</span></code> blank, it will default to a human-readble timestamp with the appropriate file extension (e.g.¬†‚Äò2020_10_13-01_28_13_PM.tsv‚Äô).</p>
</div></blockquote>
</div>
<div class="section" id="Image-Datasets">
<h4>Image Datasets<a class="headerlink" href="#Image-Datasets" title="Permalink to this headline">¬∂</a></h4>
<p>Image datasets are somewhat multi-modal in that, in order to perform supervised learning on them, they require a loosely coupled <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> that contains their labels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;brain_tumor.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>status</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>https://github.com/aiqc/aiqc/blob/file_schema/...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>https://github.com/aiqc/aiqc/blob/file_schema/...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>https://github.com/aiqc/aiqc/blob/file_schema/...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>https://github.com/aiqc/aiqc/blob/file_schema/...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>https://github.com/aiqc/aiqc/blob/file_schema/...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">['status']</span></code> column of this dataframe serves as the Label of that sample. We‚Äôll construct a <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> from this.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tabular_dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tabular_label</span> <span class="o">=</span> <span class="n">tabular_dataset</span><span class="o">.</span><span class="n">make_label</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Dataset.Image.from_urls()">
<h4><code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_urls()</span></code><a class="headerlink" href="#Dataset.Image.from_urls()" title="Permalink to this headline">¬∂</a></h4>
<p>During ingestion, all image files must have the same <code class="docutils literal notranslate"><span class="pre">Image.mode</span></code> and <code class="docutils literal notranslate"><span class="pre">Image.size</span></code> according to the Pillow library.</p>
<blockquote>
<div><p><a class="reference external" href="https://pillow.readthedocs.io/en/stable/handbook/concepts.html">https://pillow.readthedocs.io/en/stable/handbook/concepts.html</a></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">from_urls(urls:list)</span></code> needs a list of urls. In order to perform supervised learning, the order of this list must line up with the samples in your Tabular dataset. &gt; We happen to have this list prepared in the <code class="docutils literal notranslate"><span class="pre">['url']</span></code> column of the dataframe above. acts as a manifest in that it contains the URL of the image file for that sample, solely for the purposes of initial ingestion. We‚Äôll construct a <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code> from this.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_urls</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">get_remote_urls</span><span class="p">(</span><span class="n">manifest_name</span><span class="o">=</span><span class="s1">&#39;brain_tumor.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_urls</span><span class="p">(</span><span class="n">urls</span><span class="o">=</span><span class="n">image_urls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
üñºÔ∏è Validating Images üñºÔ∏è: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 80/80 [00:34&lt;00:00,  2.32it/s]
üñºÔ∏è Ingesting Images üñºÔ∏è: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 80/80 [00:24&lt;00:00,  3.29it/s]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_featureset</span> <span class="o">=</span> <span class="n">image_dataset</span><span class="o">.</span><span class="n">make_featureset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Skipping forward a bit, we bring the heterogenous <code class="docutils literal notranslate"><span class="pre">Featureset</span></code> and <code class="docutils literal notranslate"><span class="pre">Label</span></code> together in the <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>, and they can be used as normal. You can even construct a <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> from this splitset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_splitset</span> <span class="o">=</span> <span class="n">image_featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">tabular_label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.24</span>
    <span class="p">,</span> <span class="n">size_validation</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Dataset.Image.from_folder()">
<h4><code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_folder()</span></code><a class="headerlink" href="#Dataset.Image.from_folder()" title="Permalink to this headline">¬∂</a></h4>
<p>When reading images from a locally accessible folder, the fantastic <code class="docutils literal notranslate"><span class="pre">natsort.natsorted</span></code> library is used as the source of truth for the order of the files. &gt; Python reads files by insertion order rather than alpha-numerically, which isn‚Äôt intuitive for humans. So make sure your tabular manifest has the same order as <code class="docutils literal notranslate"><span class="pre">natsorted</span></code>. <a class="reference external" href="https://natsort.readthedocs.io/en/master/api.html#natsort.natsorted">https://natsort.readthedocs.io/en/master/api.html#natsort.natsorted</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_dataset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="s2">&quot;/Users/layne/desktop/brain_tumor_preprocessed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
üñºÔ∏è Validating Images üñºÔ∏è: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 80/80 [00:00&lt;00:00, 2670.23it/s]
üñºÔ∏è Ingesting Images üñºÔ∏è: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 80/80 [00:00&lt;00:00, 232.15it/s]
</pre></div></div>
</div>
<p>Here you can see the first 3 files that comprise that dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;File: 85&gt;, &lt;File: 86&gt;, &lt;File: 87&gt;]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_featureset</span> <span class="o">=</span> <span class="n">image_dataset</span><span class="o">.</span><span class="n">make_featureset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">image_splitset</span> <span class="o">=</span> <span class="n">image_featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">tabular_label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.24</span>
    <span class="p">,</span> <span class="n">size_validation</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Reading-Datasets">
<h3>Reading Datasets<a class="headerlink" href="#Reading-Datasets" title="Permalink to this headline">¬∂</a></h3>
<p>All of the sample-related objects in the API have <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code> and <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code> methods that accept the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples=[]</span></code> list of indices to fetch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns=[]</span></code> list of columns to fetch.</p></li>
<li><p>In some cases you can specify a <code class="docutils literal notranslate"><span class="pre">split</span></code>/ <code class="docutils literal notranslate"><span class="pre">fold</span></code> name.</p></li>
</ul>
<p>For structured data, since the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> itself is fairly removed from the <code class="docutils literal notranslate"><span class="pre">File.Tabular</span></code> it creates, you can get that tabular file with <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.get_main_tabular(dataset_id)</span></code> to inspect attributes like <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code>.</p>
<p>Later, we‚Äôll see how these arguments allow downstream objects like <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> and <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> to slice up the data.</p>
</div>
<div class="section" id="Dataset.Tabular.to_pandas()">
<h3><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.to_pandas()</span></code><a class="headerlink" href="#Dataset.Tabular.to_pandas()" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">79</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;sepal_width&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4.3</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>4.7</td>
      <td>3.2</td>
    </tr>
    <tr>
      <th>79</th>
      <td>5.7</td>
      <td>2.6</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Dataset.Tabular.to_numpy()">
<h3><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.to_numpy()</span></code><a class="headerlink" href="#Dataset.Tabular.to_numpy()" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">79</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;petal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_width&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[1.4, 0.2],
       [1.1, 0.1],
       [1.6, 0.2],
       [3.5, 1. ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5.1, 3.5, 1.4, 0.2, 0. ],
       [4.9, 3. , 1.4, 0.2, 0. ],
       [4.7, 3.2, 1.3, 0.2, 0. ],
       [4.6, 3.1, 1.5, 0.2, 0. ]])
</pre></div></div>
</div>
</div>
<div class="section" id="Dataset.Image.to_pillow()">
<h3><code class="docutils literal notranslate"><span class="pre">Dataset.Image.to_pillow()</span></code><a class="headerlink" href="#Dataset.Image.to_pillow()" title="Permalink to this headline">¬∂</a></h3>
<p>Returns a list of <code class="docutils literal notranslate"><span class="pre">PIL.Image</span></code>‚Äôs. You can actually see the image when you call them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">images_pillow</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">to_pillow</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">image_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">62</span><span class="p">])</span>
<span class="n">images_pillow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_api_low_level_55_0.png" src="../_images/notebooks_api_low_level_55_0.png" />
</div>
</div>
</div>
<div class="section" id="Dataset.Image.to_numpy()">
<h3><code class="docutils literal notranslate"><span class="pre">Dataset.Image.to_numpy()</span></code><a class="headerlink" href="#Dataset.Image.to_numpy()" title="Permalink to this headline">¬∂</a></h3>
<p>This simply performs <code class="docutils literal notranslate"><span class="pre">np.array(Pillow.Image)</span></code>. Returns an N-dimensional array where the dimensions vary based on the <code class="docutils literal notranslate"><span class="pre">mode</span></code> aka colorscale of the image. For example, it returns ‚Äò3D of 2Ds for black and white‚Äô or ‚Äò4D of 3Ds for colored‚Äô - which would change the class of convultional layer you would use (<code class="docutils literal notranslate"><span class="pre">Conv1D</span></code>:<code class="docutils literal notranslate"><span class="pre">Conv3D</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">images_pillow</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">image_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">62</span><span class="p">])</span>
<span class="n">images_pillow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[11, 11, 11, ..., 18, 18, 18],
       [ 4,  4,  4, ..., 18, 18, 18],
       [ 0,  0,  0, ..., 18, 18, 18],
       ...,
       [18, 18, 18, ..., 18, 18, 18],
       [18, 18, 18, ..., 18, 18, 18],
       [18, 18, 18, ..., 18, 18, 18]], dtype=uint8)
</pre></div></div>
</div>
<blockquote>
<div><p>At the moment, we haven‚Äôt found it necessary to provide a <code class="docutils literal notranslate"><span class="pre">to_pandas</span></code> method for images as they have no need for column names, the dtypes are homogenous, images are used as a whole so there is no filtering, Pandas isn‚Äôt great with 3D data, and Pillow is integrated with NumPy.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="2.-Select-the-Label-column(s).">
<h2>2. Select the <code class="docutils literal notranslate"><span class="pre">Label</span></code> column(s).<a class="headerlink" href="#2.-Select-the-Label-column(s)." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="ORM">
<h3>ORM<a class="headerlink" href="#ORM" title="Permalink to this headline">¬∂</a></h3>
<p>From a Dataset, pick the column(s) that you want to predict/ train against. Creating a <code class="docutils literal notranslate"><span class="pre">Label</span></code> won‚Äôt duplicate your data! It simply marks the Dataset <code class="docutils literal notranslate"><span class="pre">columns</span></code> to be used for supervised learning.</p>
<p>Later, we‚Äôll see that a <code class="docutils literal notranslate"><span class="pre">Label</span></code> triggers:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">supervision</span></code> attribute of a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> to be either <code class="docutils literal notranslate"><span class="pre">'unsupervised'</span></code>/<code class="docutils literal notranslate"><span class="pre">'supervised'</span></code>.</p></li>
<li><p>Approval/ rejection of the <code class="docutils literal notranslate"><span class="pre">Algorithm.analysis_type</span></code>. For example, you wouldn‚Äôt perform regression on a string label.</p></li>
</ul>
<p>Part of the magic of this library is that it prevents you from making silly mistakes like these so that you aren‚Äôt faced with some obscure NumPy/ Tensor, dtype/ dimensionality error on the nth layer of your neural network.</p>
<p>For categorical labels, but not for continuous/float labels, the <code class="docutils literal notranslate"><span class="pre">Label.unique_classes</span></code> are recorded.</p>
</div>
<div class="section" id="Deriving-Labels">
<h3>Deriving Labels<a class="headerlink" href="#Deriving-Labels" title="Permalink to this headline">¬∂</a></h3>
<p>Keep the name of the label column handy as you may want to re-use it later when excluding features.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label_column</span> <span class="o">=</span> <span class="s1">&#39;species&#39;</span>
</pre></div>
</div>
</div>
<p>Implicit IDs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">make_label</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">columns=[label_column]</span></code> is a list in case users have already OneHotEncoded (OHEd) their label. If multiple columns are provided, then they must already be in OHE format. I‚Äôm not keen on supporting multi-label/ simultaneous analysis, but that could changed based on feasibility and user demand.</p>
</div></blockquote>
<p>Explicit IDs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">other_label</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="n">other_dataset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Reading-Labels">
<h3>Reading Labels<a class="headerlink" href="#Reading-Labels" title="Permalink to this headline">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Label</span></code> comes in handy when we need to fetch what is traditionally referred to as ‚Äò<em>Y</em>‚Äô in tutorials. It also accepts a <code class="docutils literal notranslate"><span class="pre">samples</span></code> argument, so that <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> can subset it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>145</th>
      <td>2</td>
    </tr>
    <tr>
      <th>146</th>
      <td>2</td>
    </tr>
    <tr>
      <th>147</th>
      <td>2</td>
    </tr>
    <tr>
      <th>148</th>
      <td>2</td>
    </tr>
    <tr>
      <th>149</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">132</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0],
       [0],
       [1],
       [1],
       [2]])
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="3.-Select-the-Featureset-column(s).">
<h2>3. Select the <code class="docutils literal notranslate"><span class="pre">Featureset</span></code> column(s).<a class="headerlink" href="#3.-Select-the-Featureset-column(s)." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="id1">
<h3>ORM<a class="headerlink" href="#id1" title="Permalink to this headline">¬∂</a></h3>
<p>Creating a Featureset won‚Äôt duplicate your data! It simply records the Dataset <code class="docutils literal notranslate"><span class="pre">columns</span></code> to be used as features during training.</p>
<p>There are three ways to define which columns you want to use as features:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exclude_columns=[]</span></code> e.g.¬†use all columns except the label column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_columns=[]</span></code> e.g.¬†only use these columns that I think are informative.</p></li>
<li><p>Leave both of the above blank and all columns will be used (e.g.¬†images or unsupervised leanring).</p></li>
</ul>
<p>For structured data, since the Featureset is far removed from the <code class="docutils literal notranslate"><span class="pre">File.Tabular</span></code> that it is derived from, there is a <code class="docutils literal notranslate"><span class="pre">Featureset.get_dtypes()</span></code> method. This will come in handy when we are selecting dtypes/columns to include/ exclude in our <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>(s).</p>
</div>
<div class="section" id="id2">
<h3>Deriving Labels<a class="headerlink" href="#id2" title="Permalink to this headline">¬∂</a></h3>
<p>Via <code class="docutils literal notranslate"><span class="pre">include_columns=[]</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">include_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span>
    <span class="s1">&#39;petal_length&#39;</span><span class="p">,</span>
    <span class="s1">&#39;petal_width&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">make_featureset</span><span class="p">(</span><span class="n">include_columns</span><span class="o">=</span><span class="n">include_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Via <code class="docutils literal notranslate"><span class="pre">exclude_columns=[]</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">make_featureset</span><span class="p">(</span><span class="n">exclude_columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;, &#39;petal_width&#39;]
</pre></div></div>
</div>
<p>Either way, any excluded columns will be recorded since they are used for dropping.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span><span class="o">.</span><span class="n">columns_excluded</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;species&#39;]
</pre></div></div>
</div>
<p>Again, for images, just perform <code class="docutils literal notranslate"><span class="pre">Dataset.Image.make_featureset()</span></code> since you‚Äôll likely want to include all pixels and your label column is in a separate, coupled Dataset.</p>
</div>
<div class="section" id="Reading-Featuresets">
<h3>Reading Featuresets<a class="headerlink" href="#Reading-Featuresets" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5.1, 3.5, 1.4, 0.2],
       [4.9, 3. , 1.4, 0.2],
       [4.7, 3.2, 1.3, 0.2],
       [4.6, 3.1, 1.5, 0.2]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featureset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>5.4</td>
      <td>3.9</td>
      <td>1.3</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>32</th>
      <td>5.2</td>
      <td>4.1</td>
      <td>1.5</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>64</th>
      <td>5.6</td>
      <td>2.9</td>
      <td>3.6</td>
      <td>1.3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="4.-Slice-samples-with-a-Splitset.">
<h2>4. Slice samples with a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>.<a class="headerlink" href="#4.-Slice-samples-with-a-Splitset." title="Permalink to this headline">¬∂</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> divides a the samples of the Dataset into the following <em>splits</em> in the table below. It is the central object of the data preparation side of the ORM in that it touches <code class="docutils literal notranslate"><span class="pre">Label</span></code>, <code class="docutils literal notranslate"><span class="pre">Featureset</span></code>, <code class="docutils literal notranslate"><span class="pre">Foldset</span></code>, and <code class="docutils literal notranslate"><span class="pre">Encoderset</span></code>. It is the only mandatory data preparation object required by the training <code class="docutils literal notranslate"><span class="pre">Batch</span></code>.</p>
<p>Both contiuous and categorical <code class="docutils literal notranslate"><span class="pre">Labels</span></code> are automatically stratified.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Split</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>train</p></td>
<td><p>The samples that the model will be trained upon. Later, we‚Äôll see how we can make <em>cross-folds from our training split</em>. Unsupervised learning will only have a training split.</p></td>
</tr>
<tr class="row-odd"><td><p>validation (optional)</p></td>
<td><p>The samples used for training evaluation. Ensures that the test set is not revealed to the model during training.</p></td>
</tr>
<tr class="row-even"><td><p>test (optional)</p></td>
<td><p>The samples the model has never seen during training. Used to assess how well the model will perform on unobserved, natural data when it is applied in the real world aka how generalizable it is.</p></td>
</tr>
</tbody>
</table>
<p>Again, creating a Splitset won‚Äôt duplicate your data. It simply denotes the sample indices (aka rows) to be used in the splits that you specify!</p>
<div class="section" id="Split-Strategies">
<h3>Split Strategies<a class="headerlink" href="#Split-Strategies" title="Permalink to this headline">¬∂</a></h3>
<div class="section" id="a)-Default-supervised-70-30-split.">
<h4>a) Default supervised 70-30 split.<a class="headerlink" href="#a)-Default-supervised-70-30-split." title="Permalink to this headline">¬∂</a></h4>
<p>If you only provide a Label, then 70:30 train:test splits will be generated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span><span class="n">label_id</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b)-Specifying-test-size.">
<h4>b) Specifying test size.<a class="headerlink" href="#b)-Specifying-test-size." title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.30</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="c)-Specifying-validation-size.">
<h4>c) Specifying validation size.<a class="headerlink" href="#c)-Specifying-validation-size." title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.20</span>
    <span class="p">,</span> <span class="n">size_validation</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="d)-Taking-the-whole-dataset-as-a-training-split.">
<h4>d) Taking the whole dataset as a training split.<a class="headerlink" href="#d)-Taking-the-whole-dataset-as-a-training-split." title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset_unsupervised</span> <span class="o">=</span> <span class="n">featureset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>Label-based stratification is used to ensure equally distributed label classes for both categorical and continuous data.</p>
<p>If you want more control over stratification of continuous splits, specify the number of <code class="docutils literal notranslate"><span class="pre">continuous_bin_count</span></code> for grouping.</p>
</div></blockquote>
</div>
<div class="section" id="e)-Stratification-of-continuous-labels.">
<h4>e) Stratification of continuous labels.<a class="headerlink" href="#e)-Stratification-of-continuous-labels." title="Permalink to this headline">¬∂</a></h4>
<p>All splits are stratified by default in that they contain similar distributions of unique label classes so that each split is a statistically accurate representation of the population as a whole.</p>
<p>In order to support this process for continuous labels, binning/ discretization is utilized. For example, if 4 bins are used, values from <em>0.0 to 1.0</em> would be binned as <em>[0.0-0.25, 0.25-0.50, 0.50-0.75, 0.75-1.0]</em>. This is controlled by the <code class="docutils literal notranslate"><span class="pre">make_splitset(bin_count:int)</span></code> argument.</p>
<blockquote>
<div><p>Reference the handy <code class="docutils literal notranslate"><span class="pre">Pandas.qcut()</span></code> and the source code <code class="docutils literal notranslate"><span class="pre">pd.qcut(x=array_to_bin,</span> <span class="pre">q=bin_count,</span> <span class="pre">labels=False,</span> <span class="pre">duplicates='drop')</span></code> for more detail.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="Reading-Splitsets">
<h3>Reading Splitsets<a class="headerlink" href="#Reading-Splitsets" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;validation&#39;, &#39;train&#39;, &#39;test&#39;])
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.keys()</span></code> of 1st layer are referred to as ‚Äúsplit_name‚Äù in the source code: e.g.¬†‚Äòtrain‚Äô as well as, optionally, ‚Äòvalidation‚Äô and ‚Äòtest‚Äô.</p>
<p><code class="docutils literal notranslate"><span class="pre">Splitset.samples</span></code> on disk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">sample_indices</span><span class="o">&gt;</span><span class="p">],</span>
    <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">sample_indices</span><span class="o">&gt;</span><span class="p">],</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">sample_indices</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also verify the actual size of your splits.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">sizes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;validation&#39;: {&#39;percent&#39;: 0.12, &#39;count&#39;: 18},
 &#39;test&#39;: {&#39;percent&#39;: 0.2, &#39;count&#39;: 30},
 &#39;train&#39;: {&#39;percent&#39;: 0.68, &#39;count&#39;: 102}}
</pre></div></div>
</div>
<p>The main attribute of the splitset is the <code class="docutils literal notranslate"><span class="pre">samples</span></code> dictionary. Again, on-disk this only contains sample indices. The dictionary is structured like so:</p>
</div>
<div class="section" id="Splitset.to_numpy()">
<h3><code class="docutils literal notranslate"><span class="pre">Splitset.to_numpy()</span></code><a class="headerlink" href="#Splitset.to_numpy()" title="Permalink to this headline">¬∂</a></h3>
<p>When fetched to memory, the <code class="docutils literal notranslate"><span class="pre">.keys()</span></code> of the 2nd layer are: ‚Äòfeatures‚Äô and, optionally, ‚Äòlabels‚Äô.</p>
<p>Note that if you do not specified neither a <code class="docutils literal notranslate"><span class="pre">size_validation</span></code> nor <code class="docutils literal notranslate"><span class="pre">size_test</span></code>, then your dictionary will contain neither a <code class="docutils literal notranslate"><span class="pre">['validation']</span></code> nor <code class="docutils literal notranslate"><span class="pre">['test']</span></code> split.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;features&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5. , 3.5, 1.3, 0.3],
       [5.1, 3.3, 1.7, 0.5],
       [5.8, 2.7, 5.1, 1.9],
       [4.5, 2.3, 1.3, 0.3]])
</pre></div></div>
</div>
</div>
<div class="section" id="Splitset.to_pandas()">
<h3><code class="docutils literal notranslate"><span class="pre">Splitset.to_pandas()</span></code><a class="headerlink" href="#Splitset.to_pandas()" title="Permalink to this headline">¬∂</a></h3>
<p>Getting more fine-tuned, both the numpy and pandas methods support a few optional filters for the sake of memory-efficiency when fetching larger splits.</p>
<p>For example, imagine you are fetching data to specifically encode the only float column in the featureset of the test split. You don‚Äôt need the labels and you don‚Äôt need the other columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span>
    <span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">include_label</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">,</span> <span class="n">include_featureset</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">,</span> <span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepal_width&#39;</span><span class="p">]</span>
<span class="p">)[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>35</th>
      <td>3.2</td>
    </tr>
    <tr>
      <th>113</th>
      <td>2.5</td>
    </tr>
    <tr>
      <th>78</th>
      <td>2.9</td>
    </tr>
    <tr>
      <th>128</th>
      <td>2.8</td>
    </tr>
    <tr>
      <th>133</th>
      <td>2.8</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="5.-Optionally,-create-a-Foldset-for-cross-validation.">
<h2>5. Optionally, create a <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> for cross-validation.<a class="headerlink" href="#5.-Optionally,-create-a-Foldset-for-cross-validation." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="id3">
<h3>ORM<a class="headerlink" href="#id3" title="Permalink to this headline">¬∂</a></h3>
<p><em>Reference the</em><a class="reference external" href="https://scikit-learn.org/stable/modules/cross_validation.html">scikit-learn documentation</a><em>to learn more about folding.</em></p>
<p><img alt="Cross Folds" src="../_images/cross_fold.png" /></p>
<p>We refer to the left out fold (blue) as the <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> and the remaining training data as the <code class="docutils literal notranslate"><span class="pre">folds_train_combined</span></code> (green).</p>
<blockquote>
<div><p><em>In the future, we may introduce more folding ``strategies`` aside from leave-one-out.</em></p>
</div></blockquote>
<div class="section" id="Fold-objects">
<h4><code class="docutils literal notranslate"><span class="pre">Fold</span></code> objects<a class="headerlink" href="#Fold-objects" title="Permalink to this headline">¬∂</a></h4>
<p>For the sake of determining which samples get trained upon, the only thing that matters is the slice of data that gets left out.</p>
<blockquote>
<div><p>Tip - DO NOT use a <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> unless your <em>(total sample count / fold_count)</em> still gives you an accurate representation of your sample population. If you are ignoring that advice and stretching to perform cross-validation, then at least ensure that <em>(total sample count / fold_count)</em> is evenly divisible. Both of these tips help avoid poorly stratified/ undersized folds that perform either too well (only most common label class present) or poorly (handful of samples and a few inaccurate
prediction on a normally good model).</p>
<p>Tip - The sample indices of the validation fold are not discarded. In fact, <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> can actually be used alongside a split <code class="docutils literal notranslate"><span class="pre">validation</span></code> for double validation ü§ò. However, it‚Äôs more sensible to skip the validation split when cross-validating because you‚Äôll want each <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> to be as large (representative of the population) as possible. Folds naturally have fewer samples, so a handful of incorrect predictions have the potential to offset your aggregate metrics.</p>
<p>Candidly, if you‚Äôve ever performed cross-validation manually, let alone systematically, you‚Äôll know that, barring stratification of continuous labels, it‚Äôs easy enough to construct the folds, but then it‚Äôs a pain to generate performance metrics (e.g.¬†<code class="docutils literal notranslate"><span class="pre">zero_division</span></code>, absent OHE classes) due to the absence of outlying classes and bins. Time has been invested to handle these scenarios elegantly so that folds can be treated as first-class-citizens alongside splits. That being said, if you try
to do something undersized like ‚Äú150 samples in their dataset and a <code class="docutils literal notranslate"><span class="pre">fold_count</span></code> &gt; 3 with <code class="docutils literal notranslate"><span class="pre">unique_classes</span></code> &gt; 4,‚Äù then you may run into edge cases.</p>
</div></blockquote>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">Splitset.samples</span></code>, there is a <code class="docutils literal notranslate"><span class="pre">Fold.samples</span></code> dictionary of sample indices with the following <code class="docutils literal notranslate"><span class="pre">.keys()</span></code>: * <code class="docutils literal notranslate"><span class="pre">samples['folds_train_combined']</span></code> - all the included folds. * <code class="docutils literal notranslate"><span class="pre">samples['fold_validation']</span></code> - the fold that got left out.</p>
<p><img alt="cross fold objects" src="../_images/cross_fold_objects.png" /></p>
</div>
</div>
<div class="section" id="Deriving-Foldsets">
<h3>Deriving Foldsets<a class="headerlink" href="#Deriving-Foldsets" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">big_label</span> <span class="o">=</span> <span class="n">big_dataset</span><span class="o">.</span><span class="n">make_label</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
<span class="n">big_fset</span> <span class="o">=</span> <span class="n">big_dataset</span><span class="o">.</span><span class="n">make_featureset</span><span class="p">(</span><span class="n">exclude_columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
<span class="n">big_splits</span> <span class="o">=</span> <span class="n">big_fset</span><span class="o">.</span><span class="n">make_splitset</span><span class="p">(</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">big_label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.30</span>
    <span class="p">,</span> <span class="n">bin_count</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we are ready to generate 5 <code class="docutils literal notranslate"><span class="pre">Fold</span></code> objects that belong to the <code class="docutils literal notranslate"><span class="pre">Foldset</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foldset</span> <span class="o">=</span> <span class="n">big_splits</span><span class="o">.</span><span class="n">make_foldset</span><span class="p">(</span><span class="n">fold_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bin_count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">list</span><span class="p">(</span><span class="n">foldset</span><span class="o">.</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;Fold: 1&gt;, &lt;Fold: 2&gt;, &lt;Fold: 3&gt;, &lt;Fold: 4&gt;, &lt;Fold: 5&gt;]
</pre></div></div>
</div>
</div>
<div class="section" id="Reading-Foldsets">
<h3>Reading Foldsets<a class="headerlink" href="#Reading-Foldsets" title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foldset</span><span class="o">.</span><span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;folds_train_combined&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1, 2, 3, 4, 5, 6, 7, 8, 9, 11]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foldset</span><span class="o">.</span><span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;fold_validation&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 10, 16, 19, 23, 25, 27, 28, 32, 38]
</pre></div></div>
</div>
</div>
<div class="section" id="Foldset.to_numpy()">
<h3><code class="docutils literal notranslate"><span class="pre">Foldset.to_numpy()</span></code><a class="headerlink" href="#Foldset.to_numpy()" title="Permalink to this headline">¬∂</a></h3>
<p>In order to reduce memory footprint the <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code> and <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code> methods introduce the <code class="docutils literal notranslate"><span class="pre">fold_index</span></code> argument.</p>
<p>If no fold_index is specified, then it will fetch all folds and give each fold a numeric key according to its index.</p>
<p>So you need to specify the <code class="docutils literal notranslate"><span class="pre">fold_index</span></code> as the first key when accessing the dictionary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foldset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">fold_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;fold_validation&#39;</span><span class="p">][</span><span class="s1">&#39;features&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5.1, 3.5, 1.4, 0.2],
       [5.4, 3.7, 1.5, 0.2],
       [5.4, 3.9, 1.3, 0.4],
       [5.1, 3.8, 1.5, 0.3]])
</pre></div></div>
</div>
</div>
<div class="section" id="Foldset.to_pandas()">
<h3><code class="docutils literal notranslate"><span class="pre">Foldset.to_pandas()</span></code><a class="headerlink" href="#Foldset.to_pandas()" title="Permalink to this headline">¬∂</a></h3>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">splitset.to_numpy(splits:list)</span></code>, the <code class="docutils literal notranslate"><span class="pre">foldset.to_numpy(fold_names:list)</span></code> argument allows you to pluck the <code class="docutils literal notranslate"><span class="pre">['folds_train_combined]</span></code> and <code class="docutils literal notranslate"><span class="pre">['fold_validation]</span></code> slices. Just make sure you remember to specific all 3 levels of keys when accessing the result.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foldset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span>
    <span class="n">fold_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">,</span> <span class="n">fold_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;folds_train_combined&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">include_label</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">,</span> <span class="n">include_featureset</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;folds_train_combined&#39;</span><span class="p">][</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1042</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1043</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1044</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1045</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1046</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="6.-Optionally,-stage-an-Encoderset-for-encoding.">
<h2>6. Optionally, stage an <code class="docutils literal notranslate"><span class="pre">Encoderset</span></code> for encoding.<a class="headerlink" href="#6.-Optionally,-stage-an-Encoderset-for-encoding." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="Background">
<h3>Background<a class="headerlink" href="#Background" title="Permalink to this headline">¬∂</a></h3>
<p>Certain algorithms either (a) require features and/ or labels formatted a certain way, or (b) perform MUCH better when their values are normalized. For example:</p>
<ul class="simple">
<li><p>Converting ordinal or categorical string data <code class="docutils literal notranslate"><span class="pre">[dog,</span> <span class="pre">cat,</span> <span class="pre">fish]</span></code> into one-hot encoded format <code class="docutils literal notranslate"><span class="pre">[[1,0,0][0,1,0][0,0,1]]</span></code>.</p></li>
<li><p>Scaling continuous features from (-1 to 1) or (0.0 to 1.0). Or transforming them to resemble a more Gaussian distribution.</p></li>
</ul>
<p>There are two phases of encoding: 1. <code class="docutils literal notranslate"><span class="pre">fit</span></code> - where the encoder learns about the values of the samples made available to it. Ideally, you only want to <code class="docutils literal notranslate"><span class="pre">fit</span></code> aka learn from your training split so that you are not <em>‚Äúleaking‚Äù</em> information from your validation and test spits into your encoder! 2. <code class="docutils literal notranslate"><span class="pre">transform</span></code> - where the encoder transforms all of the samples in the population.</p>
<p>AIQC has solved the following challenges related to encoding:</p>
<ul class="simple">
<li><p>How does one dynamically <code class="docutils literal notranslate"><span class="pre">fit</span></code> on only the training samples in advanced scenarios like cross-validation where a different fold is used for validation each time?</p></li>
<li><p>For certain encoders, especially categorical ones, there is arguably no leakage. If an encoder is arbitrarilly assigning values/ tags to a sample through a process that is not aggregate-informed, then the information that is reveal to the <code class="docutils literal notranslate"><span class="pre">fit</span></code> is largely irrelevant. As an analogy, if we are examining swan color and all of a sudden there is a black swan‚Ä¶ it‚Äôs clearly not white, so slap a non-white label on it and move on. In fact, the prediction process and performance metric calucatlion
may fail if it doesn‚Äôt know how to handle the previously unseen category.</p></li>
<li><p>Certain encoders only accept certain dtypes. Certain encoders only accept certain dimensionality (e.g.¬†1D, 2D, 3D) or shape patterns (odd-by-odd square). Unfortunately, there is not much uniformity here.</p></li>
<li><p>Certain encoders output extraneous objects that don‚Äôt work with deep learning libraries.</p></li>
</ul>
<blockquote>
<div><p><em>For now, only ``sklearn.preprocessing`` methods are supported. That may change as we add support for more low-level tensor-based frameworks like PyTorch.</em></p>
</div></blockquote>
<p>Keeping this in mind, we create an <code class="docutils literal notranslate"><span class="pre">Encoderset</span></code> for our <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>. We can attach a <code class="docutils literal notranslate"><span class="pre">Labelcoder</span></code> and/ or <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>(s).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">encoderset</span> <span class="o">=</span> <span class="n">splitset</span><span class="o">.</span><span class="n">make_encoderset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>And then import any scikit-learn encoders that you need. AIQC only supports the uppercase methods (e.g.¬†<code class="docutils literal notranslate"><span class="pre">RobustScaler</span></code>, but not <code class="docutils literal notranslate"><span class="pre">robust_scale</span></code>) because the lowercase methods do not separate the <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> steps. FYI, most of the uppercase methods have a combined <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> method if you need them.</p>
<blockquote>
<div><p><a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing">https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="7.-Optionally,-set-a-single-Labelcoder.">
<h2>7. Optionally, set a single <code class="docutils literal notranslate"><span class="pre">Labelcoder</span></code>.<a class="headerlink" href="#7.-Optionally,-set-a-single-Labelcoder." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="id4">
<h3>Background<a class="headerlink" href="#id4" title="Permalink to this headline">¬∂</a></h3>
<p>The simplistic <code class="docutils literal notranslate"><span class="pre">Labelcoder</span></code> is a good warmup for the moe advanced <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>.</p>
<p>Of course, you cannot encode Labels if your <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> does not have labels in the first place.</p>
<p>The process is straightforward. You provide an instantiated encoder [e.g.¬†<code class="docutils literal notranslate"><span class="pre">StandardScaler()</span></code> not <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>], and then AIQC will:</p>
<ul class="simple">
<li><p>Verify that the encoder works with your <code class="docutils literal notranslate"><span class="pre">Label</span></code>‚Äôs dtype, sample values, and figure out what dimensionality it needs in order to succeed.</p></li>
<li><p>Validate the attributes of your encoder to smooth out any common errors they would cause.</p></li>
<li><p>Determine whether the encoder should be <code class="docutils literal notranslate"><span class="pre">fit</span></code> either (a) exclusively on the train split, or (b) if it is not prone to leakage, inclusively on the entire dataset thereby reducing the chance of errors arising.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labelcoder</span> <span class="o">=</span> <span class="n">encoderset</span><span class="o">.</span><span class="n">make_labelcoder</span><span class="p">(</span>
    <span class="n">sklearn_preprocess</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="8.-Optionally,-determine-a-sequence-of-Featurecoder(s).">
<h2>8. Optionally, determine a sequence of <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>(s).<a class="headerlink" href="#8.-Optionally,-determine-a-sequence-of-Featurecoder(s)." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="id5">
<h3>Background<a class="headerlink" href="#id5" title="Permalink to this headline">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code> has the same validation process as the <code class="docutils literal notranslate"><span class="pre">Labelcoder</span></code>. However, it is not without its own challenges:</p>
<ul class="simple">
<li><p>We want to be able to apply different encoders to features of different dtypes. So it‚Äôs likely that the same encoder will neither be applied to all columns, nor will all encoders be applied at the same exact time.</p></li>
<li><p>Additionally, even within the same dtype (e.g.¬†float/ continuous), different distributions call for different encoders.</p></li>
<li><p>Commonly used encoders such a <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> can ouput multiple columns from a single column input. Therefore, the structure of the features columns is not fixed during encoding.</p></li>
<li><p>And finally, throughout this entire process, we need to avoid data leakage.</p></li>
</ul>
<p>For these reasons, <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code>‚Äôs are applied sequentially; in an ordered chain, one after the other. After an encoder is applied, its columns are removed from the raw featureset and placed into an intermediary cache specific to each split/ fold.</p>
<blockquote>
<div><p>Right now, <code class="docutils literal notranslate"><span class="pre">Featurecoder</span></code> cannot be created for <code class="docutils literal notranslate"><span class="pre">Dataset.Image.Featureset</span></code>. I‚Äôm not opposed to changing this, but I would just have to account for 3D arrays.</p>
</div></blockquote>
</div>
<div class="section" id="Filtering-feature-columns">
<h3>Filtering feature columns<a class="headerlink" href="#Filtering-feature-columns" title="Permalink to this headline">¬∂</a></h3>
<p>The filtering mode is either:</p>
<ul class="simple">
<li><p>Inclusive (<code class="docutils literal notranslate"><span class="pre">include=True</span></code>) encode columns that match the filter.</p></li>
<li><p>Exclusive (<code class="docutils literal notranslate"><span class="pre">include=False</span></code>) encode columns outside of the filter.</p></li>
</ul>
<p>Then you can select:</p>
<ol class="arabic simple">
<li><p>An optional list of <code class="docutils literal notranslate"><span class="pre">dtypes</span></code>.</p></li>
<li><p>An optional list of <code class="docutils literal notranslate"><span class="pre">columns</span></code> name.</p></li>
</ol>
<ul class="simple">
<li><p>The column filter is applied after the dtype filter.</p></li>
</ul>
<blockquote>
<div><p>You can create a filter for all columns by setting <code class="docutils literal notranslate"><span class="pre">include=False</span></code> and then seting both <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div></blockquote>
<p>After submitting your encoder, if <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> is enabled: * The validation rules help determine why it may have failed. * The print statements help determine which columns your current filter matched, and which raw columns remain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">featurecoder</span> <span class="o">=</span> <span class="n">encoderset</span><span class="o">.</span><span class="n">make_featurecoder</span><span class="p">(</span>
    <span class="n">sklearn_preprocess</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;yeo-johnson&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">,</span> <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

___/ featurecoder_index: 0 \_________

=&gt; The column(s) below matched your filter(s) and were ran through a test-encoding successfully.
[&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;, &#39;petal_width&#39;]

=&gt; Nice! Now all feature column(s) have encoder(s) associated with them.
No more Featurecoders can be added to this Encoderset.

</pre></div></div>
</div>
<p>You can also view this information via the following attributes: <code class="docutils literal notranslate"><span class="pre">matching_columns</span></code>, <code class="docutils literal notranslate"><span class="pre">leftover_dtypes</span></code>, and <code class="docutils literal notranslate"><span class="pre">leftover_columns</span></code>.</p>
</div>
</div>
<div class="section" id="9.-Create-an-Algorithm-aka-model.">
<h2>9. Create an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> aka model.<a class="headerlink" href="#9.-Create-an-Algorithm-aka-model." title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="id6">
<h3>ORM<a class="headerlink" href="#id6" title="Permalink to this headline">¬∂</a></h3>
<p>Now that our data has been prepared, we transition to the other half of the ORM where the focus is the logic that will be applied to that data.</p>
<blockquote>
<div><p>An <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> is the ORM‚Äôs codename for a machine learning model since <em>Model</em> is the most important <em>reserved word</em> for ORMs.</p>
</div></blockquote>
<p>The following attributes tell AIQC how to handle the Algorithm behind the scenes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">library</span></code> - right now, only ‚Äòkeras‚Äô is supported.</p>
<ul>
<li><p>Each library‚Äôs model object and callbacks (history, early stopping) need to be handled differently.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">analysis_type</span></code> - right now, these types are supported:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'classification_multi'</span></code>, <code class="docutils literal notranslate"><span class="pre">'classification_binary'</span></code>, <code class="docutils literal notranslate"><span class="pre">'regression'</span></code>.</p></li>
<li><p>Used to determine which performance metrics to run.</p></li>
<li><p>Must be compatible with the type of label fed to it.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="Model-Definition">
<h3>Model Definition<a class="headerlink" href="#Model-Definition" title="Permalink to this headline">¬∂</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> is composed of the functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fn_build</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_train</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_lose</span></code> (optional, inferred).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> (optional, inferred).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_evaluate</span></code> (optional, inferred).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_predict</span></code> (optional, inferred).</p></li>
</ul>
<blockquote>
<div><p>May provide overridable defaults for build and train in the future.</p>
</div></blockquote>
<p>You can name the functions whatever you want, but do not change the predetermined arguments (e.g.¬†<code class="docutils literal notranslate"><span class="pre">input_shape</span></code>,<code class="docutils literal notranslate"><span class="pre">**hp</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, etc.).</p>
<p>As we define these functions, we‚Äôll see that we can pass a dictionary of <em>hyperparameters</em> into these function using the <code class="docutils literal notranslate"><span class="pre">**hp</span></code> kwarg, and access them like so: <code class="docutils literal notranslate"><span class="pre">hp['&lt;some_variable_name&gt;']</span></code>. Later, we‚Äôll provide a list of values for each entry in the hyperparameters dictionary.</p>
<p>Let‚Äôs import the modules that we need.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">History</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>Later, when running your <code class="docutils literal notranslate"><span class="pre">Job</span></code>‚Äôs, if you receive a ‚Äúmodule not found‚Äù error, then you can try troubleshooting by importing that module directly within the function where it is used.</p>
</div></blockquote>
<div class="section" id="Function-to-build-model">
<h4>Function to build model<a class="headerlink" href="#Function-to-build-model" title="Permalink to this headline">¬∂</a></h4>
<p>You can build your topology however you like, just be sure to <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">model</span></code>. Also, you don‚Äôt have to use any of the hyperparameters (<code class="docutils literal notranslate"><span class="pre">**hp</span></code>) if you don‚Äôt want to.</p>
<p>The automatically provided <code class="docutils literal notranslate"><span class="pre">features_shape</span></code> and <code class="docutils literal notranslate"><span class="pre">label_shape</span></code> are handy because:</p>
<ul class="simple">
<li><p>The number of feature/ label columns is mutable due to encoders (e.g.¬†OHE).</p></li>
<li><p>Shapes can be less obvious in multi-dimensional scenarios like colored images.</p></li>
</ul>
<blockquote>
<div><p>You can customize the metrics if you so desire (e.g.¬†change the loss or accuracy), but they will only be applied to the training process/ <code class="docutils literal notranslate"><span class="pre">History</span></code> callback. We‚Äôll see later that AIQC will calculate metrics for you automatically.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_build</span><span class="p">(</span><span class="n">features_shape</span><span class="p">,</span> <span class="n">label_shape</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;neuron_count&#39;</span><span class="p">],</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">features_shape</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;he_uniform&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;neuron_count&#39;</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;he_uniform&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">label_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>
    <span class="c1">#optimizer and loss defined separately.</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Optional,-function-to-optimize-model.">
<h4>Optional, function to optimize model.<a class="headerlink" href="#Optional,-function-to-optimize-model." title="Permalink to this headline">¬∂</a></h4>
<p>Some deep learning libraries persist their model and optimizer separately during checkpoint/exporting. So <code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> provides an isolated way to access the optimizer. It also allows us to automatically set the optimizer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_optimize</span><span class="p">(</span><span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adamax</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">optimizer</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>If you want to define your own optimizer, then you should do so within this function, rather than relying on <code class="docutils literal notranslate"><span class="pre">model.compile(optimizer='&lt;some_optimizer_name&gt;'</span></code>. If you do not define an optimizer, then <code class="docutils literal notranslate"><span class="pre">Adamax</span></code> will be used by default.</p>
</div></blockquote>
</div>
<div class="section" id="Function-to-train-model">
<h4>Function to train model<a class="headerlink" href="#Function-to-train-model" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples_train</span></code> - the appropriate data will be fed into the training cycle. For example, <code class="docutils literal notranslate"><span class="pre">Foldset.samples[fold_index]['folds_train_combined']</span></code> or <code class="docutils literal notranslate"><span class="pre">Splitset.samples['train']</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_evaluate</span></code> - the appropriate data is made available for evaluation. For example, <code class="docutils literal notranslate"><span class="pre">Foldset.samples[fold_index]['fold_validation']</span></code>, <code class="docutils literal notranslate"><span class="pre">Splitset.samples['validation']</span></code>, or <code class="docutils literal notranslate"><span class="pre">Splitset.samples['test']</span></code>.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">samples_train</span><span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;categorical_crossentropy&#39;</span>
        <span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;epoch_count&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">History</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<div class="section" id="Optional,-callback-to-stop-training-early.">
<h5>Optional, callback to stop training early.<a class="headerlink" href="#Optional,-callback-to-stop-training-early." title="Permalink to this headline">¬∂</a></h5>
<p><em>Early stopping</em> isn‚Äôt just about efficiency in reducing the number of <code class="docutils literal notranslate"><span class="pre">epochs</span></code>. If you‚Äôve specified 300 epochs, there‚Äôs a chance your model catches on to the underlying patterns early, say around 75-125 epochs. At this point, there‚Äôs also good chance what it learns in the remaining epochs will cause it to overfit on patterns that are specific to the training data, and thereby and lose it‚Äôs simplicity/ generalizability.</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">val_</span></code> prefix refers to the evaluation samples.</p>
<p>Remember, regression does not have accuracy metrics.</p>
<p><code class="docutils literal notranslate"><span class="pre">TrainingCallback.Keras.MetricCutoff</span></code> is a custom class we wrote to make multi-metric cutoffs easier, so you won‚Äôt find information about it in the official Keras documentation.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_train</span><span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;categorical_crossentropy&#39;</span>
        <span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1">#Define one or more metrics to monitor.</span>
    <span class="n">metrics_cuttoffs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s2">&quot;above_or_below&quot;</span><span class="p">:</span><span class="s2">&quot;above&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;above_or_below&quot;</span><span class="p">:</span><span class="s2">&quot;below&quot;</span><span class="p">}</span>
    <span class="p">]</span>
    <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">TrainingCallback</span><span class="o">.</span><span class="n">Keras</span><span class="o">.</span><span class="n">MetricCutoff</span><span class="p">(</span><span class="n">metrics_cuttoffs</span><span class="p">)</span>
    <span class="c1"># Remember to append `cutoffs` to the list of callbacks.</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">History</span><span class="p">(),</span> <span class="n">cutoffs</span><span class="p">]</span>

    <span class="c1"># No changes here.</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;epoch_count&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Optional,-function-to-predict-samples">
<h4>Optional, function to predict samples<a class="headerlink" href="#Optional,-function-to-predict-samples" title="Permalink to this headline">¬∂</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">fn_predict</span></code> will be generated for you automatically if set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. The <code class="docutils literal notranslate"><span class="pre">analysis_type</span></code> and <code class="docutils literal notranslate"><span class="pre">library</span></code> of the Algorithm help determine how to handle the predictions.</p>
<div class="section" id="a)-Regression-default.">
<h5>a) Regression default.<a class="headerlink" href="#a)-Regression-default." title="Permalink to this headline">¬∂</a></h5>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b)-Classification-binary-default.">
<h5>b) Classification binary default.<a class="headerlink" href="#b)-Classification-binary-default." title="Permalink to this headline">¬∂</a></h5>
<p>All classification <code class="docutils literal notranslate"><span class="pre">predictions</span></code>, both mutliclass and binary, must be returned in ordinal format.</p>
<blockquote>
<div><p>For most libraries, classification algorithms output <em>probabilities</em> as opposed to actual predictions when running <code class="docutils literal notranslate"><span class="pre">model.predict()</span></code>. We want to return both of these object <code class="docutils literal notranslate"><span class="pre">predictions,</span> <span class="pre">probabilities</span></code> (the order matters) to generate performance metrics behind the scenes.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="c1"># This is the official keras replacement for binary classes `.predict_classes()`</span>
    <span class="c1"># It returns one array per sample: `[[0][1][0][1]]`</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">probabilities</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="c)-Classification-multiclass-default.">
<h5>c) Classification multiclass default.<a class="headerlink" href="#c)-Classification-multiclass-default." title="Permalink to this headline">¬∂</a></h5>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="c1"># This is the official keras replacement for multiclass `.predict_classes()`</span>
    <span class="c1"># It returns one ordinal array per sample: `[[0][2][1][2]]`</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Optional,-function-to-calculate-loss">
<h4>Optional, function to calculate loss<a class="headerlink" href="#Optional,-function-to-calculate-loss" title="Permalink to this headline">¬∂</a></h4>
<p>When creating an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>, the evaluate function will be generated for you automatically if set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. The <code class="docutils literal notranslate"><span class="pre">analysis_type</span></code> and <code class="docutils literal notranslate"><span class="pre">library</span></code> of the Algorithm help determine how to handle the predictions.</p>
<p>The only trick thing here is when <code class="docutils literal notranslate"><span class="pre">keras.metrics</span></code> returns multiple metrics, like <em>accuracy</em> and/ or <em>R^2</em>. All we are after in this case is the loss for the split/ fold in question.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_loss</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">):</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">samples_evaluate</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">],</span> <span class="n">samples_evaluate</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Yikes - The &#39;metrics&#39; returned are neither a list nor a float:</span><span class="se">\n</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>In contrast to openly specifying a loss function, for example <code class="docutils literal notranslate"><span class="pre">keras.losses.&lt;loss_fn&gt;()</span></code>, the use of <code class="docutils literal notranslate"><span class="pre">.evaluate()</span></code> is consistent because it comes from the compiled model. Also, although <code class="docutils literal notranslate"><span class="pre">model.compiled_loss</span></code> would be more efficient, it requires making encoded <code class="docutils literal notranslate"><span class="pre">y_true</span></code> and <code class="docutils literal notranslate"><span class="pre">y_pred</span></code> available to the user, whereas <code class="docutils literal notranslate"><span class="pre">.evaluate()</span></code> can be called with the same arugments as the other <code class="docutils literal notranslate"><span class="pre">fn_*</span></code> and many deep learning libraries support this approach.</p>
</div></blockquote>
</div>
<div class="section" id="Group-the-functions-together-in-an-Algorithm!">
<h4>Group the functions together in an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>!<a class="headerlink" href="#Group-the-functions-together-in-an-Algorithm!" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Algorithm</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">library</span> <span class="o">=</span> <span class="s2">&quot;keras&quot;</span>
    <span class="p">,</span> <span class="n">analysis_type</span> <span class="o">=</span> <span class="s2">&quot;classification_multi&quot;</span>
    <span class="p">,</span> <span class="n">fn_build</span> <span class="o">=</span> <span class="n">fn_build</span>
    <span class="p">,</span> <span class="n">fn_train</span> <span class="o">=</span> <span class="n">fn_train</span>
    <span class="p">,</span> <span class="n">fn_optimize</span> <span class="o">=</span> <span class="n">fn_optimize</span> <span class="c1"># Optional</span>
    <span class="p">,</span> <span class="n">fn_predict</span> <span class="o">=</span> <span class="n">fn_predict</span> <span class="c1"># Optional</span>
    <span class="p">,</span> <span class="n">fn_loss</span> <span class="o">=</span> <span class="n">fn_loss</span> <span class="c1"># Optional</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>&lt;!&gt; Remember to use <code class="docutils literal notranslate"><span class="pre">make</span></code> and not <code class="docutils literal notranslate"><span class="pre">create</span></code>. Deceptively, <code class="docutils literal notranslate"><span class="pre">create</span></code> runs because it is a standard, built-in ORM method. However, it does so without any validation logic.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="8.-Optional,-associate-a-Hyperparamset-with-your-model.">
<h2>8. Optional, associate a <code class="docutils literal notranslate"><span class="pre">Hyperparamset</span></code> with your model.<a class="headerlink" href="#8.-Optional,-associate-a-Hyperparamset-with-your-model." title="Permalink to this headline">¬∂</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">hyperparameters</span></code> below will be automatically fed into the functions above as <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> via the <code class="docutils literal notranslate"><span class="pre">**hp</span></code> argument we saw earlier.</p>
<p>For example, wherever you see <code class="docutils literal notranslate"><span class="pre">hp['neuron_count']</span></code>, it will pull from the <em>key:value</em> pair <code class="docutils literal notranslate"><span class="pre">&quot;neuron_count&quot;:</span> <span class="pre">[9,</span> <span class="pre">12]</span></code> seen below. Where ‚Äúmodel A‚Äù would have 9 neurons and ‚Äúmodel B‚Äù would have 12 neurons.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;neuron_count&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">]</span>
    <span class="p">,</span> <span class="s2">&quot;epoch_count&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
    <span class="p">,</span> <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">hyperparamset</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Hyperparamset</span><span class="o">.</span><span class="n">from_algorithm</span><span class="p">(</span>
    <span class="n">algorithm_id</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>The number of unique combinations escalates quickly, so in the future, we will provide different strategies for generating and selecting parameters to experiment with.</p>
</div></blockquote>
<p>Each unique combination of hyperparameters is recorded as a <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code>.</p>
<p>Ultimately, a training <code class="docutils literal notranslate"><span class="pre">Job</span></code> will be constructed for each unique combinanation of hyperparameters aka <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamset</span><span class="o">.</span><span class="n">hyperparamcombo_count</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamcombos</span> <span class="o">=</span> <span class="n">hyperparamset</span><span class="o">.</span><span class="n">hyperparamcombos</span>

<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hyperparamcombos</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hyperparameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;neuron_count&#39;: 12, &#39;epoch_count&#39;: 30, &#39;learning_rate&#39;: 0.01}
{&#39;neuron_count&#39;: 12, &#39;epoch_count&#39;: 30, &#39;learning_rate&#39;: 0.03}
{&#39;neuron_count&#39;: 12, &#39;epoch_count&#39;: 60, &#39;learning_rate&#39;: 0.01}
{&#39;neuron_count&#39;: 12, &#39;epoch_count&#39;: 60, &#39;learning_rate&#39;: 0.03}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamcombos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">(</span><span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>param</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>neuron_count</td>
      <td>12.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>epoch_count</td>
      <td>30.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>learning_rate</td>
      <td>0.01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="9.-Create-a-Batch-of-training-Jobs.">
<h2>9. Create a <code class="docutils literal notranslate"><span class="pre">Batch</span></code> of training <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.<a class="headerlink" href="#9.-Create-a-Batch-of-training-Jobs." title="Permalink to this headline">¬∂</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Batch</span></code> is the central object of the ‚Äúlogic side‚Äù of the ORM. It ties together everything we need for training and hyperparameter tuning.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">aiqc</span><span class="o">.</span><span class="n">Batch</span><span class="o">.</span><span class="n">from_algorithm</span><span class="p">(</span>
    <span class="n">algorithm_id</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">splitset_id</span> <span class="o">=</span> <span class="n">splitset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">hyperparamset_id</span> <span class="o">=</span> <span class="n">hyperparamset</span><span class="o">.</span><span class="n">id</span> <span class="c1"># Optional.</span>
    <span class="p">,</span> <span class="n">foldset_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Optional.</span>
    <span class="p">,</span> <span class="n">encoderset_id</span> <span class="o">=</span> <span class="n">encoderset</span><span class="o">.</span><span class="n">id</span> <span class="c1"># Optional.</span>
    <span class="p">,</span> <span class="n">repeat_count</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">repeat_count:int</span></code> allows us to run the same <code class="docutils literal notranslate"><span class="pre">Job</span></code> multiple times. Normally, each <code class="docutils literal notranslate"><span class="pre">Job</span></code> has 1 <code class="docutils literal notranslate"><span class="pre">Result</span></code> object associated with it upon completion. However, when <code class="docutils literal notranslate"><span class="pre">repeat_count</span></code> (&gt; 1 of course) is used, a single <code class="docutils literal notranslate"><span class="pre">Job</span></code> will have multiple <code class="docutils literal notranslate"><span class="pre">Results</span></code>.</p></li>
</ul>
<blockquote>
<div><p>Due to the fact that training is a <em>nondeterministic</em> process, we are likely to get different results each time we train a model, even if we use the same set of parameters. Perhaps you‚Äôve have the right topology and parameters, but, this time around, the model just didn‚Äôt recgonize the patterns. Similar to flipping a coin, there is a degree of chance in it, but the real trend averages out upon repetition.</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hide_test:bool</span></code> excludes the test split from the performance metrics and visualizations. This avoids data leakage by forcing the user to make decisions based on the performance on their model on the training and evaluation samples.</p></li>
</ul>
<div class="section" id="Job-objects.">
<h3><code class="docutils literal notranslate"><span class="pre">Job</span></code> objects.<a class="headerlink" href="#Job-objects." title="Permalink to this headline">¬∂</a></h3>
<p>Each <code class="docutils literal notranslate"><span class="pre">Job</span></code> in the Batch represents a <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code> that needs to be trained.</p>
<blockquote>
<div><p>If a <code class="docutils literal notranslate"><span class="pre">Foldset</span></code> is used during <code class="docutils literal notranslate"><span class="pre">Batch</span></code> creation, then (a) the number of jobs is multiplied by the <code class="docutils literal notranslate"><span class="pre">hyperparamcombo_count</span></code> and the <code class="docutils literal notranslate"><span class="pre">fold_count</span></code>, (b) each Job will have a <code class="docutils literal notranslate"><span class="pre">Fold</span></code>. Additionally, a superficial <code class="docutils literal notranslate"><span class="pre">Jobset</span></code> will be used to keep track of all Jobs related to that Foldset.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">poll_statuses(as_pandas:bool=False)</span></code> is used to determine which Job-repeats have been completed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">batch</span><span class="o">.</span><span class="n">poll_statuses</span><span class="p">(</span><span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>job_id</th>
      <th>repeat_index</th>
      <th>result_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3</td>
      <td>1</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>1</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>2</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>2</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3</td>
      <td>2</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4</td>
      <td>2</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Execute-all-Jobs.">
<h3>Execute all <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.<a class="headerlink" href="#Execute-all-Jobs." title="Permalink to this headline">¬∂</a></h3>
<p>There are two ways to execute a Batch of Jobs:</p>
<div class="section" id="1.-batch.run_jobs(in_background=False)">
<h4>1. <code class="docutils literal notranslate"><span class="pre">batch.run_jobs(in_background=False)</span></code><a class="headerlink" href="#1.-batch.run_jobs(in_background=False)" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>Jobs are simply ran on a loop on the main <em>Process</em>.</p></li>
<li><p>Stop the Jobs with a keyboard interrupt e.g.¬†<code class="docutils literal notranslate"><span class="pre">ctrl+Z/D/C</span></code> in Python shell or <code class="docutils literal notranslate"><span class="pre">i,i</span></code> in Jupyter.</p></li>
<li><p>It is the more reliable approach on Win/Mac/Lin.</p></li>
<li><p>Although this locks your main process (can‚Äôt write more code) while models train, you can still fire up a second shell session or notebook.</p></li>
<li><p>Prototype your training jobs in this method so that you can see any errors that arise in the console.</p></li>
</ul>
</div>
<div class="section" id="2.-batch.run_jobs(in_background=True);-experimental">
<h4>2. <code class="docutils literal notranslate"><span class="pre">batch.run_jobs(in_background=True)</span></code>; experimental<a class="headerlink" href="#2.-batch.run_jobs(in_background=True);-experimental" title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>The Jobs loop is executed on a separate, parallel <code class="docutils literal notranslate"><span class="pre">multiprocessing.Process</span></code></p></li>
<li><p>Stop the Jobs with <code class="docutils literal notranslate"><span class="pre">batch.stop_jobs()</span></code>, which kills the parallel <em>Process</em> unless it already failed.</p></li>
<li><p>The benefit is that you can continue to code while your models are trained. There is no performance boost.</p></li>
<li><p>On Mac and Linux (Unix), <code class="docutils literal notranslate"><span class="pre">'fork'</span></code> multiprocessing is used (<code class="docutils literal notranslate"><span class="pre">force=True</span></code>), which allows us to display the progress bar. FYI, even in ‚Äòfork‚Äô mode, Python multiprocessing is much more fragile in Python 3.8, which seems to be caused by how pickling is handled in passing variables to the child process.</p></li>
<li><p>On Windows, <code class="docutils literal notranslate"><span class="pre">'spawn'</span></code> multiprocessing is used, which requires polling:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">batch.poll_statuses()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">batch.poll_progress(raw:bool=False,</span> <span class="pre">loop:bool=False,</span> <span class="pre">loop_delay:int=3)</span></code> where <code class="docutils literal notranslate"><span class="pre">raw=True</span></code> is just a float, <code class="docutils literal notranslate"><span class="pre">loop=True</span></code> won‚Äôt stop checking jobs until they are all complete, and <code class="docutils literal notranslate"><span class="pre">loop_delay=3</span></code> checks the progress every 3 seconds.</p></li>
</ul>
</li>
<li><p>It is a known bug that the <code class="docutils literal notranslate"><span class="pre">aiqc.TrainingCallbacks.Keras.MetricCutoff</span></code> class does not work with <code class="docutils literal notranslate"><span class="pre">in_background=True</span></code> as of Python 3.8.</p></li>
<li><p>Also, during stress tests, I observed that when running multiple batches at the same time, the SQLite database would lock when simultaneous writes were attempted.</p></li>
</ul>
</div>
<div class="section" id="3.-Future,-distributed-cloud-execution.">
<h4>3. Future, distributed cloud execution.<a class="headerlink" href="#3.-Future,-distributed-cloud-execution." title="Permalink to this headline">¬∂</a></h4>
<ul class="simple">
<li><p>In the future, we look to provide options for horizontal and vertical scale via either AWS or Azure.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">batch</span><span class="o">.</span><span class="n">run_jobs</span><span class="p">(</span><span class="n">in_background</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
üîÆ Training Models üîÆ: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 12/12 [00:49&lt;00:00,  4.14s/it]
</pre></div></div>
</div>
<p>The queue is interuptable. You can stop the execution of a batch and resume it later.</p>
<blockquote>
<div><p>This also comes in handy if either your machine or Python kernel either crashes or are interupted by accident. Whatever the reason, rest easy, just <code class="docutils literal notranslate"><span class="pre">run_jobs()</span></code> again to pick up where you left off. Be aware that the <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> iteration time in the progress bar will be wrong because it will be divided by the jobs already ran.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="10.-Assess-the-Results.">
<h2>10. Assess the <code class="docutils literal notranslate"><span class="pre">Results</span></code>.<a class="headerlink" href="#10.-Assess-the-Results." title="Permalink to this headline">¬∂</a></h2>
<p>Each <code class="docutils literal notranslate"><span class="pre">Job</span></code> has a <code class="docutils literal notranslate"><span class="pre">Result</span></code>. The following attributes are automatically written to the <code class="docutils literal notranslate"><span class="pre">Result</span></code> after training.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code>: HDF5 bytes of the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">history</span></code>: per epoch metrics recorded during training.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predictions</span></code>: dictionary of predictions per split/ fold.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">probabilities</span></code>: dictionary of prediction probabilities per split/ fold.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metrics</span></code>: dictionary of single-value metrics depending on the analysis_type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_data</span></code>: metrics readily formatted for plotting.</p></li>
</ul>
<blockquote>
<div><p>The dictionary attributes use split/ fold-based keys.</p>
</div></blockquote>
<div class="section" id="Fetching-the-trained-model.">
<h3>Fetching the trained model.<a class="headerlink" href="#Fetching-the-trained-model." title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">compiled_model</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
<span class="n">compiled_model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;tensorflow.python.keras.engine.sequential.Sequential at 0x14ac08460&gt;
</pre></div></div>
</div>
</div>
<div class="section" id="Fetching-metrics.">
<h3>Fetching metrics.<a class="headerlink" href="#Fetching-metrics." title="Permalink to this headline">¬∂</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">batch</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;test&#39;: {&#39;accuracy&#39;: 0.9666666666666667,
  &#39;f1&#39;: 0.9665831244778613,
  &#39;loss&#39;: 0.13921520113945007,
  &#39;precision&#39;: 0.9696969696969696,
  &#39;recall&#39;: 0.9666666666666667,
  &#39;roc_auc&#39;: 0.9966666666666666},
 &#39;validation&#39;: {&#39;accuracy&#39;: 0.9444444444444444,
  &#39;f1&#39;: 0.9440559440559441,
  &#39;loss&#39;: 0.22046174108982086,
  &#39;precision&#39;: 0.9523809523809523,
  &#39;recall&#39;: 0.9444444444444444,
  &#39;roc_auc&#39;: 0.976851851851852},
 &#39;train&#39;: {&#39;accuracy&#39;: 0.9607843137254902,
  &#39;f1&#39;: 0.9607843137254902,
  &#39;loss&#39;: 0.13327109813690186,
  &#39;precision&#39;: 0.9607843137254902,
  &#39;recall&#39;: 0.9607843137254902,
  &#39;roc_auc&#39;: 0.9969723183391003}}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="11.-Metrics-&amp;-Visualization">
<h2>11. Metrics &amp; Visualization<a class="headerlink" href="#11.-Metrics-&-Visualization" title="Permalink to this headline">¬∂</a></h2>
<p>For more information on visualization of performance metrics, reference the <a class="reference external" href="visualization.html">Visualization &amp; Metrics</a> documentation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="visualization.html" class="btn btn-neutral float-right" title="Visualization &amp; Metrics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api_high_level.html" class="btn btn-neutral float-left" title="High-Level API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>